<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
	integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
	crossorigin="anonymous">

<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css"
	integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
	crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
	integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
	crossorigin="anonymous"></script>
<script
	src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"
	integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
	crossorigin="anonymous"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"
	integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
	crossorigin="anonymous"></script>

<link type="text/css" th:href="@{/css/styles.css}"
	href="/css/styles.css" rel="stylesheet" />

<title>TTA - Home</title>
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<a class="navbar-brand" th:href="@{/}"> <svg class="mb-2"
				stroke="currentColor" fill="currentColor" stroke-width="0"
				viewBox="0 0 640 512" height="1em" width="1em"
				xmlns="http://www.w3.org/2000/svg">
            <path
					d="M48 0C21.5 0 0 21.5 0 48V464c0 26.5 21.5 48 48 48h96V432c0-26.5 21.5-48 48-48s48 21.5 48 48v80h89.9c-6.3-10.2-9.9-22.2-9.9-35.1c0-46.9 25.8-87.8 64-109.2V271.8 48c0-26.5-21.5-48-48-48H48zM64 240c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V240zm112-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V240c0-8.8 7.2-16 16-16zm80 16c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H272c-8.8 0-16-7.2-16-16V240zM80 96h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16zm80 16c0-8.8 7.2-16 16-16h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V112zM272 96h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16H272c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16zM576 272a80 80 0 1 0 -160 0 80 80 0 1 0 160 0zM352 477.1c0 19.3 15.6 34.9 34.9 34.9H605.1c19.3 0 34.9-15.6 34.9-34.9c0-51.4-41.7-93.1-93.1-93.1H445.1c-51.4 0-93.1 41.7-93.1 93.1z"></path>
        </svg> Ticket Tracker App
		</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse"
			data-target="#navbarSupportedContent"
			aria-controls="navbarSupportedContent" aria-expanded="false"
			aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav ml-auto">
				<li class="nav-item active"><a class="nav-link" th:href="@{/}">All
						Tickets <span class="sr-only">(current)</span>
				</a></li>
			</ul>
			<a th:href="@{/create-new-ticket}"
				class="btn btn-light btn-sm ml-lg-2"> New Ticket </a>
		</div>
	</nav>

	<div class="container">
		<h3 class="mt-2 text-center">List of Tickets</h3>
		<hr>
		<div class="d-flex justify-content-between mb-3">

			<form th:action="@{/}" method="GET"
				class="input-group input-group-sm w-50 mr-1">
				<input id="search" name="search" type="text" class="form-control"
					aria-label="Sizing example input"
					aria-describedby="inputGroup-sizing-sm"
					placeholder="Search by title or description...">
				<div class="input-group-append">
					<div>
						<button class="btn btn-outline-primary btn-sm" type="submit">
							Search
							<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15"
								fill="currentColor" class="bi bi-search ml-1"
								viewBox="0 0 15 15">
								<path
									d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
							</svg>
						</button>
					</div>
				</div>
			</form>
		</div>
		<table class="table table-sm table-bordered table-striped">
			<thead class="thead-dark">
				<tr>
					<th scope="col">#</th>
					<th scope="col">Title</th>
					<th scope="col">Description</th>
					<th scope="col">Created On</th>
					<th scope="col">Updated On</th>
					<th scope="col">Actions</th>
				</tr>
			</thead>
			<tbody>
				<tr th:if="${tickets.size() > 0}" th:each="ticket : ${tickets}">
					<!-- view modal -->
					<div class="modal fade" th:id="viewModal+${ticket.id}"
						tabindex="-1" role="dialog" aria-labelledby="viewModalLabel"
						aria-hidden="true">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h4 class="modal-title h4" id="viewModalLabel">View Ticket</h4>

									<button type="button" class="close" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body h6">
									<label>Title : </label> <span th:text="${ticket.title}"></span>
									<hr />
									<label>Description : </label> <span
										th:text="${ticket.description}"></span>
									<hr />
									<div class="d-flex justify-content-between">
										<div>
											<label>Created On : </label> <span
												th:text="${T(com.tta.utils.Utils).formatdate(ticket.createdAt)}"></span>
										</div>
										<strong>|</strong>
										<div>
											<label>Last Updated On : </label> <span
												th:text="${T(com.tta.utils.Utils).formatdate(ticket.updatedAt)}"></span>
										</div>
									</div>
									<hr />
									<label>Content : </label>

									<!-- <div class="form-control" th:utext="${ticket.content}" /> -->
									<textarea th:id="'editor-' + ${ticket.id}" name="content"
										th:text="${ticket.content}" class="editor form-control">
										</textarea>


								</div>
								<div class="modal-footer">
									<a th:href="@{/update/{id}(id=${ticket.id})}"
										class="btn btn-success"> Edit </a>



									<button type="button" class="btn btn-danger"
										data-toggle="modal"
										th:attr="data-target='#deleteModal'+${ticket.id}"
										data-target="#deleteModal">Delete</button>
									<button type="button" class="btn btn-secondary"
										data-dismiss="modal">Close</button>
								</div>
							</div>
						</div>
					</div>

					<!-- delete modal -->
					<div class="modal fade" th:id="deleteModal+${ticket.id}"
						tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
						aria-hidden="true">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h4 class="modal-title h4" id="exampleModalLabel">Are you
										sure you want to delete?</h4>
									<button type="button" class="close" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body h6">
									<label>Title : </label> <span th:text="${ticket.title}"></span>
									<hr />
									<label>Description : </label> <span
										th:text="${ticket.description}"></span>
								</div>
								<div class="modal-footer">
									<form th:action="@{/delete/{id}(id=${ticket.id})}" method="GET">
										<input type="hidden" name="id" th:value="${ticket.id}" />
										<button type="submit" class="btn btn-danger">Yes!
											Delete it</button>
									</form>
									<button type="button" class="btn btn-secondary"
										data-dismiss="modal">Keep it</button>
								</div>
							</div>
						</div>
					</div>
					<td scope="row" class="h6" th:text="${ticket.id}" />
					<td scope="row" class="h6" th:text="${ticket.title}" />
					<td scope="row" class="h6" th:text="${ticket.description}" />
					<!--<td class="h6" th:text="${ticket.createdAt}" />-->
					<td scope="row" class="h6"
						th:text="${T(com.tta.utils.Utils).formatdate(ticket.createdAt)}"></td>

					<td scope="row" class="h6"
						th:text="${T(com.tta.utils.Utils).formatdate(ticket.updatedAt)}"></td>

					<td scope="row">
						<div class="btn-group" role="group" aria-label="Basic example">
							<!-- edit button -->
							<a th:href="@{/update/{id}(id=${ticket.id})}"
								class="btn text-success"> <svg
									xmlns="http://www.w3.org/2000/svg" width="24" height="24"
									fill="currentColor" class="bi bi-pencil-square"
									viewBox="0 0 15 15">
											<path
										d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
											<path fill-rule="evenodd"
										d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z" />
										</svg>
							</a>

							<!-- delete button -->

							<button type="button" class="btn text-danger" data-toggle="modal"
								th:attr="data-target='#deleteModal'+${ticket.id}"
								data-target="#deleteModal">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
									fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
										<path
										d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
										<path
										d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
									</svg>
							</button>

							<!-- view button -->
							<button type="button" class="btn text-primary"
								data-toggle="modal"
								th:attr="data-target='#viewModal'+${ticket.id}"
								data-target="#viewModal">
								<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg"
									fill="currentColor" viewBox="0 0 1.26 1.26"
									xml:space="preserve">
										<path
										d="M.459.603c0 .093.078.171.171.171S.801.696.801.603.723.432.63.432.459.51.459.603m.243.369C.903.927 1.215.66 1.215.66S.984.3.675.261C.657.258.597.258.585.258c-.3.03-.54.411-.54.411s.261.258.51.297a.4.4 0 0 0 .147.006M.333.621C.333.465.465.339.63.339s.297.126.297.282S.795.9.63.9.333.774.333.621" /></svg>
							</button>
						</div>
					</td>

				</tr>
				<tr th:unless="${tickets.size() > 0}">
					<td scope="row" colspan="6" class="h6 text-center"><svg
							width="30px" height="30px" viewBox="0 0 64 64"
							xmlns="http://www.w3.org/2000/svg" stroke-width="3"
							stroke="#000000" fill="none">
							<polyline
								points="34.48 54.28 11.06 54.28 11.06 18.61 23.02 5.75 48.67 5.75 48.67 39.42" />
							<polyline points="23.04 5.75 23.02 18.61 11.06 18.61" />
							<line x1="16.21" y1="45.68" x2="28.22" y2="45.68" />
							<line x1="16.21" y1="39.15" x2="31.22" y2="39.15" />
							<line x1="16.21" y1="33.05" x2="43.22" y2="33.05" />
							<line x1="16.21" y1="26.95" x2="43.22" y2="26.95" />
							<circle cx="42.92" cy="48.24" r="10.01" stroke-linecap="round" />
							<line x1="39.05" y1="44.36" x2="46.8" y2="52.11" />
							<line x1="39.05" y1="52.11" x2="46.8" y2="44.36" /></svg> No Tickets
						Found</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- CKEditor script -->
	<script
		src="https://cdn.ckeditor.com/ckeditor5/36.0.1/classic/ckeditor.js"></script>

	<script>
		function makeTextareasReadOnly() {
			var textareas = document.querySelectorAll('.editor');
			textareas.forEach(function(textarea) {
				/* console.log(textarea)*/
				textarea.readOnly = true;

				let id = '#' + textarea["id"];

				ClassicEditor
					.create(document.querySelector(id), { toolbar: [] })
					.then(editor => {
						editor.enableReadOnlyMode(id);
					})
					.catch(error => {
						console.error(error);
					});
			});
		}

		window.addEventListener('DOMContentLoaded', makeTextareasReadOnly);

		$('.modal').on('show.bs.modal', function(e) {
			$('.modal').modal('hide');
		});

		</script>
</body>

</html>